

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Creating the SF DTA Network from Cube Network and Defining the Scenario &mdash; DTA Anyway v1.0 documentation</title>
    <link rel="stylesheet" href="_static/dta.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="DTA Anyway v1.0 documentation" href="index.html" />
    <link rel="next" title="Importing Transit Routes" href="script_importTPPlusTransitRoutes.html" />
    <link rel="prev" title="dta.Utils" href="_generated/dta.Utils.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="script_importTPPlusTransitRoutes.html" title="Importing Transit Routes"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="_generated/dta.Utils.html" title="dta.Utils"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">DTA Anyway v1.0 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="module-createSFNetworkFromCubeNetwork">
<span id="creating-the-sf-dta-network-from-cube-network-and-defining-the-scenario"></span><h1>Creating the SF DTA Network from Cube Network and Defining the Scenario<a class="headerlink" href="#module-createSFNetworkFromCubeNetwork" title="Permalink to this headline">¶</a></h1>
<dl class="function">
<dt id="createSFNetworkFromCubeNetwork.addShifts">
<tt class="descclassname">createSFNetworkFromCubeNetwork.</tt><tt class="descname">addShifts</tt><big>(</big><em>sanfranciscoCubeNet</em><big>)</big><a class="reference internal" href="_modules/createSFNetworkFromCubeNetwork.html#addShifts"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#createSFNetworkFromCubeNetwork.addShifts" title="Permalink to this definition">¶</a></dt>
<dd><p>The San Francisco network has a few places where the roadway geometries need clarification via &#8220;shifts&#8221; &#8211;
e.g. some local lanes need to be shifted to be outside the through lanes.</p>
</dd></dl>

<dl class="function">
<dt id="createSFNetworkFromCubeNetwork.createTransitOnlyLanes">
<tt class="descclassname">createSFNetworkFromCubeNetwork.</tt><tt class="descname">createTransitOnlyLanes</tt><big>(</big><em>sanfranciscoCubeNet</em>, <em>allVCG</em>, <em>transitVCG</em><big>)</big><a class="reference internal" href="_modules/createSFNetworkFromCubeNetwork.html#createTransitOnlyLanes"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#createSFNetworkFromCubeNetwork.createTransitOnlyLanes" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates transit-only lanes based on the BUSLANE_PM field.</p>
</dd></dl>

<dl class="function">
<dt id="createSFNetworkFromCubeNetwork.removeHOVStubs">
<tt class="descclassname">createSFNetworkFromCubeNetwork.</tt><tt class="descname">removeHOVStubs</tt><big>(</big><em>sanfranciscoDynameqNet</em><big>)</big><a class="reference internal" href="_modules/createSFNetworkFromCubeNetwork.html#removeHOVStubs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#createSFNetworkFromCubeNetwork.removeHOVStubs" title="Permalink to this definition">¶</a></dt>
<dd><p>The San Francisco network has a few &#8220;HOV stubs&#8221; &#8211; links intended to facilitate future coding of HOV lanes
Find these and remove them</p>
</dd></dl>

<div class="section" id="main">
<h2>Main<a class="headerlink" href="#main" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226</pre></div></td><td class="code"><div class="highlight"><pre><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    
    <span class="n">optlist</span><span class="p">,</span> <span class="n">args</span> <span class="o">=</span> <span class="n">getopt</span><span class="o">.</span><span class="n">getopt</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="s">&quot;n:l:&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">print</span> <span class="n">USAGE</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    
    <span class="n">SF_CUBE_NET_FILE</span>            <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">SF_CUBE_TURN_PROHIBITIONS</span>   <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    
    <span class="n">SF_CUBE_SHAPEFILE</span>           <span class="o">=</span> <span class="bp">None</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">:</span>
        <span class="n">SF_CUBE_SHAPEFILE</span>       <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

    <span class="n">OUTPUT_NODE_SHAPEFILE</span>       <span class="o">=</span> <span class="bp">None</span>
    <span class="n">OUTPUT_LINK_SHAPEFILE</span>       <span class="o">=</span> <span class="bp">None</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">opt</span><span class="p">,</span><span class="n">arg</span><span class="p">)</span> <span class="ow">in</span> <span class="n">optlist</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">opt</span><span class="o">==</span><span class="s">&quot;-n&quot;</span><span class="p">:</span>
            <span class="n">OUTPUT_NODE_SHAPEFILE</span>  <span class="o">=</span> <span class="n">arg</span>
        <span class="k">elif</span> <span class="n">opt</span><span class="o">==</span><span class="s">&quot;-l&quot;</span><span class="p">:</span>
            <span class="n">OUTPUT_LINK_SHAPEFILE</span>  <span class="o">=</span> <span class="n">arg</span>
            
    <span class="c"># The SanFrancisco network will use feet for vehicle lengths and coordinates, and miles for link lengths</span>
    <span class="n">dta</span><span class="o">.</span><span class="n">VehicleType</span><span class="o">.</span><span class="n">LENGTH_UNITS</span><span class="o">=</span> <span class="s">&quot;feet&quot;</span>
    <span class="n">dta</span><span class="o">.</span><span class="n">Node</span><span class="o">.</span><span class="n">COORDINATE_UNITS</span>   <span class="o">=</span> <span class="s">&quot;feet&quot;</span>
    <span class="n">dta</span><span class="o">.</span><span class="n">RoadLink</span><span class="o">.</span><span class="n">LENGTH_UNITS</span>   <span class="o">=</span> <span class="s">&quot;miles&quot;</span>

    <span class="n">dta</span><span class="o">.</span><span class="n">setupLogging</span><span class="p">(</span><span class="s">&quot;createSFNetworkFromCubeNetwork.INFO.log&quot;</span><span class="p">,</span> <span class="s">&quot;createSFNetworkFromCubeNetwork.DEBUG.log&quot;</span><span class="p">,</span> <span class="n">logToConsole</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        
    <span class="c"># The rest of San Francisco currently exists as a Cube network.  Initialize it from</span>
    <span class="c"># the Cube network files (which have been exported to dbfs.)</span>
    <span class="c"># This is where we define the :py:class:`dta.Scenario`</span>
    <span class="n">sanfranciscoScenario</span> <span class="o">=</span> <span class="n">dta</span><span class="o">.</span><span class="n">DynameqScenario</span><span class="p">(</span><span class="n">dta</span><span class="o">.</span><span class="n">Time</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="n">dta</span><span class="o">.</span><span class="n">Time</span><span class="p">(</span><span class="mi">23</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>

    <span class="c"># We will have 4 vehicle classes: Car_NoToll, Car_Toll, Truck_NoToll, Truck_Toll </span>
    <span class="c"># We will provide demand matrices for each of these classes</span>
    <span class="n">sanfranciscoScenario</span><span class="o">.</span><span class="n">addVehicleClass</span><span class="p">(</span><span class="s">&quot;Car_NoToll&quot;</span><span class="p">)</span>
    <span class="n">sanfranciscoScenario</span><span class="o">.</span><span class="n">addVehicleClass</span><span class="p">(</span><span class="s">&quot;Car_Toll&quot;</span><span class="p">)</span>
    <span class="n">sanfranciscoScenario</span><span class="o">.</span><span class="n">addVehicleClass</span><span class="p">(</span><span class="s">&quot;Truck_NoToll&quot;</span><span class="p">)</span>
    <span class="n">sanfranciscoScenario</span><span class="o">.</span><span class="n">addVehicleClass</span><span class="p">(</span><span class="s">&quot;Truck_Toll&quot;</span><span class="p">)</span>
    <span class="c"># Transit is an implicit type</span>
    
    <span class="c"># length is in feet (from above), response time is in seconds, maxSpeed is in mi/hour</span>
    <span class="c"># We have only 2 vehicle types                      Type        VehicleClass    Length  RespTime    MaxSpeed    SpeedRatio</span>
    <span class="n">sanfranciscoScenario</span><span class="o">.</span><span class="n">addVehicleType</span><span class="p">(</span><span class="n">dta</span><span class="o">.</span><span class="n">VehicleType</span><span class="p">(</span><span class="s">&quot;Car&quot;</span><span class="p">,</span>      <span class="s">&quot;Car_NoToll&quot;</span><span class="p">,</span>   <span class="mi">14</span><span class="p">,</span>     <span class="mi">1</span><span class="p">,</span>          <span class="mf">100.0</span><span class="p">,</span>      <span class="mf">100.0</span><span class="p">))</span>
    <span class="n">sanfranciscoScenario</span><span class="o">.</span><span class="n">addVehicleType</span><span class="p">(</span><span class="n">dta</span><span class="o">.</span><span class="n">VehicleType</span><span class="p">(</span><span class="s">&quot;Car&quot;</span><span class="p">,</span>      <span class="s">&quot;Car_Toll&quot;</span><span class="p">,</span>     <span class="mi">14</span><span class="p">,</span>     <span class="mi">1</span><span class="p">,</span>          <span class="mf">100.0</span><span class="p">,</span>      <span class="mf">100.0</span><span class="p">))</span>
    <span class="n">sanfranciscoScenario</span><span class="o">.</span><span class="n">addVehicleType</span><span class="p">(</span><span class="n">dta</span><span class="o">.</span><span class="n">VehicleType</span><span class="p">(</span><span class="s">&quot;Truck&quot;</span><span class="p">,</span>    <span class="s">&quot;Truck_NoToll&quot;</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span>     <span class="mf">1.6</span><span class="p">,</span>        <span class="mf">70.0</span><span class="p">,</span>       <span class="mf">90.0</span><span class="p">))</span>
    <span class="n">sanfranciscoScenario</span><span class="o">.</span><span class="n">addVehicleType</span><span class="p">(</span><span class="n">dta</span><span class="o">.</span><span class="n">VehicleType</span><span class="p">(</span><span class="s">&quot;Truck&quot;</span><span class="p">,</span>    <span class="s">&quot;Truck_Toll&quot;</span><span class="p">,</span>   <span class="mi">30</span><span class="p">,</span>     <span class="mf">1.6</span><span class="p">,</span>        <span class="mf">70.0</span><span class="p">,</span>       <span class="mf">90.0</span><span class="p">))</span>
    <span class="n">sanfranciscoScenario</span><span class="o">.</span><span class="n">addVehicleType</span><span class="p">(</span><span class="n">dta</span><span class="o">.</span><span class="n">VehicleType</span><span class="p">(</span><span class="s">&quot;LRT1&quot;</span><span class="p">,</span>     <span class="s">&quot;Transit&quot;</span><span class="p">,</span>      <span class="mi">75</span><span class="p">,</span>     <span class="mf">1.6</span><span class="p">,</span>        <span class="mf">35.0</span><span class="p">,</span>       <span class="mf">90.0</span><span class="p">))</span>
    <span class="n">sanfranciscoScenario</span><span class="o">.</span><span class="n">addVehicleType</span><span class="p">(</span><span class="n">dta</span><span class="o">.</span><span class="n">VehicleType</span><span class="p">(</span><span class="s">&quot;LRT2&quot;</span><span class="p">,</span>     <span class="s">&quot;Transit&quot;</span><span class="p">,</span>     <span class="mi">150</span><span class="p">,</span>     <span class="mf">1.6</span><span class="p">,</span>        <span class="mf">35.0</span><span class="p">,</span>       <span class="mf">90.0</span><span class="p">))</span>
    <span class="n">sanfranciscoScenario</span><span class="o">.</span><span class="n">addVehicleType</span><span class="p">(</span><span class="n">dta</span><span class="o">.</span><span class="n">VehicleType</span><span class="p">(</span><span class="s">&quot;Trolley_Std&quot;</span><span class="p">,</span>  <span class="s">&quot;Transit&quot;</span><span class="p">,</span>  <span class="mi">40</span><span class="p">,</span>     <span class="mf">1.6</span><span class="p">,</span>        <span class="mf">70.0</span><span class="p">,</span>       <span class="mf">90.0</span><span class="p">))</span>
    <span class="n">sanfranciscoScenario</span><span class="o">.</span><span class="n">addVehicleType</span><span class="p">(</span><span class="n">dta</span><span class="o">.</span><span class="n">VehicleType</span><span class="p">(</span><span class="s">&quot;Trolley_Artic&quot;</span><span class="p">,</span><span class="s">&quot;Transit&quot;</span><span class="p">,</span>  <span class="mi">60</span><span class="p">,</span>     <span class="mf">1.6</span><span class="p">,</span>        <span class="mf">70.0</span><span class="p">,</span>       <span class="mf">90.0</span><span class="p">))</span>
    <span class="n">sanfranciscoScenario</span><span class="o">.</span><span class="n">addVehicleType</span><span class="p">(</span><span class="n">dta</span><span class="o">.</span><span class="n">VehicleType</span><span class="p">(</span><span class="s">&quot;Motor_Std&quot;</span><span class="p">,</span>    <span class="s">&quot;Transit&quot;</span><span class="p">,</span>  <span class="mi">40</span><span class="p">,</span>     <span class="mf">1.6</span><span class="p">,</span>        <span class="mf">70.0</span><span class="p">,</span>       <span class="mf">90.0</span><span class="p">))</span>
    <span class="n">sanfranciscoScenario</span><span class="o">.</span><span class="n">addVehicleType</span><span class="p">(</span><span class="n">dta</span><span class="o">.</span><span class="n">VehicleType</span><span class="p">(</span><span class="s">&quot;Motor_Artic&quot;</span><span class="p">,</span>  <span class="s">&quot;Transit&quot;</span><span class="p">,</span>  <span class="mi">60</span><span class="p">,</span>     <span class="mf">1.6</span><span class="p">,</span>        <span class="mf">70.0</span><span class="p">,</span>       <span class="mf">90.0</span><span class="p">))</span>
    <span class="n">sanfranciscoScenario</span><span class="o">.</span><span class="n">addVehicleType</span><span class="p">(</span><span class="n">dta</span><span class="o">.</span><span class="n">VehicleType</span><span class="p">(</span><span class="s">&quot;CableCar&quot;</span><span class="p">,</span>     <span class="s">&quot;Transit&quot;</span><span class="p">,</span>  <span class="mf">27.5</span><span class="p">,</span>   <span class="mf">1.6</span><span class="p">,</span>         <span class="mf">9.5</span><span class="p">,</span>       <span class="mf">90.0</span><span class="p">))</span>    
    <span class="c"># Generic is an implicit type</span>

    <span class="c"># VehicleClassGroups</span>
    <span class="n">allVCG</span>     <span class="o">=</span> <span class="n">dta</span><span class="o">.</span><span class="n">VehicleClassGroup</span><span class="p">(</span><span class="n">dta</span><span class="o">.</span><span class="n">VehicleClassGroup</span><span class="o">.</span><span class="n">CLASSDEFINITION_ALL</span><span class="p">,</span>        <span class="n">dta</span><span class="o">.</span><span class="n">VehicleClassGroup</span><span class="o">.</span><span class="n">CLASSDEFINITION_ALL</span><span class="p">,</span>          <span class="s">&quot;#bebebe&quot;</span><span class="p">)</span>
    <span class="n">transitVCG</span> <span class="o">=</span> <span class="n">dta</span><span class="o">.</span><span class="n">VehicleClassGroup</span><span class="p">(</span><span class="n">dta</span><span class="o">.</span><span class="n">VehicleClassGroup</span><span class="o">.</span><span class="n">CLASSDEFINITION_TRANSIT</span><span class="p">,</span>    <span class="n">dta</span><span class="o">.</span><span class="n">VehicleClassGroup</span><span class="o">.</span><span class="n">CLASSDEFINITION_TRANSIT</span><span class="p">,</span>      <span class="s">&quot;#55ff00&quot;</span><span class="p">)</span>
    <span class="n">sanfranciscoScenario</span><span class="o">.</span><span class="n">addVehicleClassGroup</span><span class="p">(</span><span class="n">allVCG</span><span class="p">)</span>
    <span class="n">sanfranciscoScenario</span><span class="o">.</span><span class="n">addVehicleClassGroup</span><span class="p">(</span><span class="n">transitVCG</span><span class="p">)</span>
    <span class="n">sanfranciscoScenario</span><span class="o">.</span><span class="n">addVehicleClassGroup</span><span class="p">(</span><span class="n">dta</span><span class="o">.</span><span class="n">VehicleClassGroup</span><span class="p">(</span><span class="n">dta</span><span class="o">.</span><span class="n">VehicleClassGroup</span><span class="o">.</span><span class="n">CLASSDEFINITION_PROHIBITED</span><span class="p">,</span> <span class="n">dta</span><span class="o">.</span><span class="n">VehicleClassGroup</span><span class="o">.</span><span class="n">CLASSDEFINITION_PROHIBITED</span><span class="p">,</span>   <span class="s">&quot;#ffff00&quot;</span><span class="p">))</span>
    <span class="n">sanfranciscoScenario</span><span class="o">.</span><span class="n">addVehicleClassGroup</span><span class="p">(</span><span class="n">dta</span><span class="o">.</span><span class="n">VehicleClassGroup</span><span class="p">(</span><span class="s">&quot;Toll&quot;</span><span class="p">,</span>                           <span class="s">&quot;Car_Toll|Truck_Toll&quot;</span><span class="p">,</span>                              <span class="s">&quot;#0055ff&quot;</span><span class="p">))</span>
    
    <span class="c"># Generalized cost</span>
    <span class="c"># TODO: Make this better!?!</span>
    <span class="n">sanfranciscoScenario</span><span class="o">.</span><span class="n">addGeneralizedCost</span><span class="p">(</span><span class="s">&quot;Expression_0&quot;</span><span class="p">,</span> <span class="c"># name</span>
                                            <span class="s">&quot;Seconds&quot;</span><span class="p">,</span>      <span class="c"># units</span>
                                            <span class="s">&quot;ptime+(left_turn_pc*left_turn)+(right_turn_pc*right_turn)&quot;</span><span class="p">,</span> <span class="c"># turn_expr</span>
                                            <span class="s">&quot;0&quot;</span><span class="p">,</span>            <span class="c"># link_expr</span>
                                            <span class="s">&quot;&quot;</span>              <span class="c"># descr</span>
                                            <span class="p">)</span>
    
    <span class="c"># Read the Cube network</span>
    <span class="n">sanfranciscoCubeNet</span> <span class="o">=</span> <span class="n">dta</span><span class="o">.</span><span class="n">CubeNetwork</span><span class="p">(</span><span class="n">sanfranciscoScenario</span><span class="p">)</span>
    <span class="n">centroidIds</span>         <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">982</span><span class="p">)</span>  <span class="c"># centroids 1-981 are internal to SF</span>
    <span class="n">centroidIds</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="mi">1204</span><span class="p">,</span><span class="mi">1205</span><span class="p">,</span><span class="mi">1207</span><span class="p">,</span><span class="mi">1191</span><span class="p">,</span><span class="mi">1192</span><span class="p">,</span><span class="mi">1206</span><span class="p">,</span><span class="mi">6987</span><span class="p">,</span><span class="mi">6994</span><span class="p">,</span><span class="mi">7144</span><span class="p">,</span><span class="mi">7177</span><span class="p">,</span>
                        <span class="mi">7654</span><span class="p">,</span><span class="mi">7677</span><span class="p">,</span><span class="mi">7678</span><span class="p">,</span><span class="mi">7705</span><span class="p">,</span><span class="mi">7706</span><span class="p">,</span><span class="mi">7709</span><span class="p">,</span><span class="mi">7721</span><span class="p">,</span><span class="mi">7972</span><span class="p">,</span><span class="mi">7973</span><span class="p">,</span><span class="mi">8338</span><span class="p">,</span>
                        <span class="mi">8339</span><span class="p">,</span><span class="mi">8832</span><span class="p">])</span>     <span class="c"># externals</span>
    <span class="c"># Derived in Y:\dta\TrafficFlowParameters.xlsx</span>
    <span class="c"># Updated for freeways and expressways based on Caltrans sensors for freeways in SF</span>
    <span class="c"># Updated for locals/collectors and arterials based on MTA speed data</span>
    <span class="n">speedLookup</span> <span class="o">=</span> <span class="p">{</span> \
        <span class="s">&#39;FT1 AT0&#39;</span><span class="p">:</span><span class="mi">35</span><span class="p">,</span> <span class="s">&#39;FT1 AT1&#39;</span><span class="p">:</span><span class="mi">40</span><span class="p">,</span> <span class="s">&#39;FT1 AT2&#39;</span><span class="p">:</span><span class="mi">45</span><span class="p">,</span> <span class="s">&#39;FT1 AT3&#39;</span><span class="p">:</span><span class="mi">45</span><span class="p">,</span> <span class="s">&#39;FT1 AT4&#39;</span><span class="p">:</span><span class="mi">55</span><span class="p">,</span> <span class="s">&#39;FT1 AT5&#39;</span><span class="p">:</span><span class="mi">55</span><span class="p">,</span> 
        <span class="s">&#39;FT2 AT0&#39;</span><span class="p">:</span><span class="mi">50</span><span class="p">,</span> <span class="s">&#39;FT2 AT1&#39;</span><span class="p">:</span><span class="mi">65</span><span class="p">,</span> <span class="s">&#39;FT2 AT2&#39;</span><span class="p">:</span><span class="mi">65</span><span class="p">,</span> <span class="s">&#39;FT2 AT3&#39;</span><span class="p">:</span><span class="mi">65</span><span class="p">,</span> <span class="s">&#39;FT2 AT4&#39;</span><span class="p">:</span><span class="mi">70</span><span class="p">,</span> <span class="s">&#39;FT2 AT5&#39;</span><span class="p">:</span><span class="mi">70</span><span class="p">,</span> 
        <span class="s">&#39;FT3 AT0&#39;</span><span class="p">:</span><span class="mi">50</span><span class="p">,</span> <span class="s">&#39;FT3 AT1&#39;</span><span class="p">:</span><span class="mi">65</span><span class="p">,</span> <span class="s">&#39;FT3 AT2&#39;</span><span class="p">:</span><span class="mi">65</span><span class="p">,</span> <span class="s">&#39;FT3 AT3&#39;</span><span class="p">:</span><span class="mi">65</span><span class="p">,</span> <span class="s">&#39;FT3 AT4&#39;</span><span class="p">:</span><span class="mi">65</span><span class="p">,</span> <span class="s">&#39;FT3 AT5&#39;</span><span class="p">:</span><span class="mi">65</span><span class="p">,</span> 
        <span class="s">&#39;FT4 AT0&#39;</span><span class="p">:</span><span class="mi">20</span><span class="p">,</span> <span class="s">&#39;FT4 AT1&#39;</span><span class="p">:</span><span class="mi">25</span><span class="p">,</span> <span class="s">&#39;FT4 AT2&#39;</span><span class="p">:</span><span class="mi">30</span><span class="p">,</span> <span class="s">&#39;FT4 AT3&#39;</span><span class="p">:</span><span class="mi">30</span><span class="p">,</span> <span class="s">&#39;FT4 AT4&#39;</span><span class="p">:</span><span class="mi">35</span><span class="p">,</span> <span class="s">&#39;FT4 AT5&#39;</span><span class="p">:</span><span class="mi">35</span><span class="p">,</span> 
        <span class="s">&#39;FT5 AT0&#39;</span><span class="p">:</span><span class="mi">30</span><span class="p">,</span> <span class="s">&#39;FT5 AT1&#39;</span><span class="p">:</span><span class="mi">30</span><span class="p">,</span> <span class="s">&#39;FT5 AT2&#39;</span><span class="p">:</span><span class="mi">35</span><span class="p">,</span> <span class="s">&#39;FT5 AT3&#39;</span><span class="p">:</span><span class="mi">35</span><span class="p">,</span> <span class="s">&#39;FT5 AT4&#39;</span><span class="p">:</span><span class="mi">40</span><span class="p">,</span> <span class="s">&#39;FT5 AT5&#39;</span><span class="p">:</span><span class="mi">40</span><span class="p">,</span> 
        <span class="s">&#39;FT7 AT0&#39;</span><span class="p">:</span><span class="mi">25</span><span class="p">,</span> <span class="s">&#39;FT7 AT1&#39;</span><span class="p">:</span><span class="mi">30</span><span class="p">,</span> <span class="s">&#39;FT7 AT2&#39;</span><span class="p">:</span><span class="mi">35</span><span class="p">,</span> <span class="s">&#39;FT7 AT3&#39;</span><span class="p">:</span><span class="mi">35</span><span class="p">,</span> <span class="s">&#39;FT7 AT4&#39;</span><span class="p">:</span><span class="mi">40</span><span class="p">,</span> <span class="s">&#39;FT7 AT5&#39;</span><span class="p">:</span><span class="mi">40</span><span class="p">,</span> 
        <span class="s">&#39;FT11 AT0&#39;</span><span class="p">:</span><span class="mi">20</span><span class="p">,</span> <span class="s">&#39;FT11 AT1&#39;</span><span class="p">:</span><span class="mi">25</span><span class="p">,</span> <span class="s">&#39;FT11 AT2&#39;</span><span class="p">:</span><span class="mi">30</span><span class="p">,</span> <span class="s">&#39;FT11 AT3&#39;</span><span class="p">:</span><span class="mi">30</span><span class="p">,</span> <span class="s">&#39;FT11 AT4&#39;</span><span class="p">:</span><span class="mi">35</span><span class="p">,</span> <span class="s">&#39;FT11 AT5&#39;</span><span class="p">:</span><span class="mi">35</span><span class="p">,</span> 
        <span class="s">&#39;FT12 AT0&#39;</span><span class="p">:</span><span class="mi">25</span><span class="p">,</span> <span class="s">&#39;FT12 AT1&#39;</span><span class="p">:</span><span class="mi">30</span><span class="p">,</span> <span class="s">&#39;FT12 AT2&#39;</span><span class="p">:</span><span class="mi">35</span><span class="p">,</span> <span class="s">&#39;FT12 AT3&#39;</span><span class="p">:</span><span class="mi">35</span><span class="p">,</span> <span class="s">&#39;FT12 AT4&#39;</span><span class="p">:</span><span class="mi">40</span><span class="p">,</span> <span class="s">&#39;FT12 AT5&#39;</span><span class="p">:</span><span class="mi">40</span><span class="p">,</span> 
        <span class="s">&#39;FT15 AT0&#39;</span><span class="p">:</span><span class="mi">25</span><span class="p">,</span> <span class="s">&#39;FT15 AT1&#39;</span><span class="p">:</span><span class="mi">30</span><span class="p">,</span> <span class="s">&#39;FT15 AT2&#39;</span><span class="p">:</span><span class="mi">35</span><span class="p">,</span> <span class="s">&#39;FT15 AT3&#39;</span><span class="p">:</span><span class="mi">35</span><span class="p">,</span> <span class="s">&#39;FT15 AT4&#39;</span><span class="p">:</span><span class="mi">50</span><span class="p">,</span> <span class="s">&#39;FT15 AT5&#39;</span><span class="p">:</span><span class="mi">50</span><span class="p">,</span> 
    <span class="p">}</span>
    <span class="c"># Derived in Y:\dta\TrafficFlowParameters.xlsx</span>
    <span class="n">responseTimeLookup</span> <span class="o">=</span> <span class="p">{</span> \
        <span class="s">&#39;FT1 AT0&#39;</span><span class="p">:</span><span class="mf">1.3747</span><span class="p">,</span> <span class="s">&#39;FT1 AT1&#39;</span><span class="p">:</span><span class="mf">1.4146</span><span class="p">,</span> <span class="s">&#39;FT1 AT2&#39;</span><span class="p">:</span><span class="mf">1.3973</span><span class="p">,</span> <span class="s">&#39;FT1 AT3&#39;</span><span class="p">:</span><span class="mf">1.3973</span><span class="p">,</span> <span class="s">&#39;FT1 AT4&#39;</span><span class="p">:</span><span class="mf">1.3967</span><span class="p">,</span> <span class="s">&#39;FT1 AT5&#39;</span><span class="p">:</span><span class="mf">1.3967</span><span class="p">,</span> 
        <span class="s">&#39;FT2 AT0&#39;</span><span class="p">:</span><span class="mf">1.3332</span><span class="p">,</span> <span class="s">&#39;FT2 AT1&#39;</span><span class="p">:</span><span class="mf">1.3535</span><span class="p">,</span> <span class="s">&#39;FT2 AT2&#39;</span><span class="p">:</span><span class="mf">1.3295</span><span class="p">,</span> <span class="s">&#39;FT2 AT3&#39;</span><span class="p">:</span><span class="mf">1.3438</span><span class="p">,</span> <span class="s">&#39;FT2 AT4&#39;</span><span class="p">:</span><span class="mf">1.3172</span><span class="p">,</span> <span class="s">&#39;FT2 AT5&#39;</span><span class="p">:</span><span class="mf">1.3172</span><span class="p">,</span> 
        <span class="s">&#39;FT3 AT0&#39;</span><span class="p">:</span><span class="mf">1.9918</span><span class="p">,</span> <span class="s">&#39;FT3 AT1&#39;</span><span class="p">:</span><span class="mf">1.9918</span><span class="p">,</span> <span class="s">&#39;FT3 AT2&#39;</span><span class="p">:</span><span class="mf">1.7999</span><span class="p">,</span> <span class="s">&#39;FT3 AT3&#39;</span><span class="p">:</span><span class="mf">1.8142</span><span class="p">,</span> <span class="s">&#39;FT3 AT4&#39;</span><span class="p">:</span><span class="mf">1.7480</span><span class="p">,</span> <span class="s">&#39;FT3 AT5&#39;</span><span class="p">:</span><span class="mf">1.7480</span><span class="p">,</span> 
        <span class="s">&#39;FT4 AT0&#39;</span><span class="p">:</span><span class="mf">4.7892</span><span class="p">,</span> <span class="s">&#39;FT4 AT1&#39;</span><span class="p">:</span><span class="mf">4.4273</span><span class="p">,</span> <span class="s">&#39;FT4 AT2&#39;</span><span class="p">:</span><span class="mf">4.1113</span><span class="p">,</span> <span class="s">&#39;FT4 AT3&#39;</span><span class="p">:</span><span class="mf">3.7949</span><span class="p">,</span> <span class="s">&#39;FT4 AT4&#39;</span><span class="p">:</span><span class="mf">3.2806</span><span class="p">,</span> <span class="s">&#39;FT4 AT5&#39;</span><span class="p">:</span><span class="mf">3.0688</span><span class="p">,</span> 
        <span class="s">&#39;FT5 AT0&#39;</span><span class="p">:</span><span class="mf">1.8427</span><span class="p">,</span> <span class="s">&#39;FT5 AT1&#39;</span><span class="p">:</span><span class="mf">1.8427</span><span class="p">,</span> <span class="s">&#39;FT5 AT2&#39;</span><span class="p">:</span><span class="mf">1.7377</span><span class="p">,</span> <span class="s">&#39;FT5 AT3&#39;</span><span class="p">:</span><span class="mf">1.7377</span><span class="p">,</span> <span class="s">&#39;FT5 AT4&#39;</span><span class="p">:</span><span class="mf">1.7776</span><span class="p">,</span> <span class="s">&#39;FT5 AT5&#39;</span><span class="p">:</span><span class="mf">1.7776</span><span class="p">,</span> 
        <span class="s">&#39;FT7 AT0&#39;</span><span class="p">:</span><span class="mf">3.0156</span><span class="p">,</span> <span class="s">&#39;FT7 AT1&#39;</span><span class="p">:</span><span class="mf">2.8806</span><span class="p">,</span> <span class="s">&#39;FT7 AT2&#39;</span><span class="p">:</span><span class="mf">2.7521</span><span class="p">,</span> <span class="s">&#39;FT7 AT3&#39;</span><span class="p">:</span><span class="mf">2.7521</span><span class="p">,</span> <span class="s">&#39;FT7 AT4&#39;</span><span class="p">:</span><span class="mf">2.7521</span><span class="p">,</span> <span class="s">&#39;FT7 AT5&#39;</span><span class="p">:</span><span class="mf">2.7521</span><span class="p">,</span> 
        <span class="s">&#39;FT11 AT0&#39;</span><span class="p">:</span><span class="mf">9.1528</span><span class="p">,</span> <span class="s">&#39;FT11 AT1&#39;</span><span class="p">:</span><span class="mf">9.2273</span><span class="p">,</span> <span class="s">&#39;FT11 AT2&#39;</span><span class="p">:</span><span class="mf">9.2806</span><span class="p">,</span> <span class="s">&#39;FT11 AT3&#39;</span><span class="p">:</span><span class="mf">7.9091</span><span class="p">,</span> <span class="s">&#39;FT11 AT4&#39;</span><span class="p">:</span><span class="mf">7.9091</span><span class="p">,</span> <span class="s">&#39;FT11 AT5&#39;</span><span class="p">:</span><span class="mf">7.9091</span><span class="p">,</span> 
        <span class="s">&#39;FT12 AT0&#39;</span><span class="p">:</span><span class="mf">4.0581</span><span class="p">,</span> <span class="s">&#39;FT12 AT1&#39;</span><span class="p">:</span><span class="mf">3.7416</span><span class="p">,</span> <span class="s">&#39;FT12 AT2&#39;</span><span class="p">:</span><span class="mf">3.5605</span><span class="p">,</span> <span class="s">&#39;FT12 AT3&#39;</span><span class="p">:</span><span class="mf">3.3205</span><span class="p">,</span> <span class="s">&#39;FT12 AT4&#39;</span><span class="p">:</span><span class="mf">3.3205</span><span class="p">,</span> <span class="s">&#39;FT12 AT5&#39;</span><span class="p">:</span><span class="mf">3.3205</span><span class="p">,</span> 
        <span class="s">&#39;FT15 AT0&#39;</span><span class="p">:</span><span class="mf">3.0688</span><span class="p">,</span> <span class="s">&#39;FT15 AT1&#39;</span><span class="p">:</span><span class="mf">2.9205</span><span class="p">,</span> <span class="s">&#39;FT15 AT2&#39;</span><span class="p">:</span><span class="mf">2.7831</span><span class="p">,</span> <span class="s">&#39;FT15 AT3&#39;</span><span class="p">:</span><span class="mf">2.8080</span><span class="p">,</span> <span class="s">&#39;FT15 AT4&#39;</span><span class="p">:</span><span class="mf">2.8080</span><span class="p">,</span> <span class="s">&#39;FT15 AT5&#39;</span><span class="p">:</span><span class="mf">2.8080</span><span class="p">,</span> 
    <span class="p">}</span>
    <span class="c"># see http://code.google.com/p/dta/wiki/NetworkDescriptionForSF</span>
    <span class="n">ftToDTALookup</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;2&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
                     <span class="s">&quot;3&quot;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span>
                     <span class="s">&quot;1&quot;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span>
                     <span class="s">&quot;7&quot;</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span>
                     <span class="s">&quot;15&quot;</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span>
                     <span class="s">&quot;12&quot;</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span>
                     <span class="s">&quot;4&quot;</span><span class="p">:</span><span class="mi">6</span><span class="p">,</span>
                     <span class="s">&quot;11&quot;</span><span class="p">:</span><span class="mi">7</span><span class="p">,</span>
                     <span class="s">&quot;5&quot;</span><span class="p">:</span><span class="mi">8</span><span class="p">,</span>
                     <span class="c"># centroid connectors should be what?</span>
                     <span class="s">&quot;6&quot;</span><span class="p">:</span><span class="mi">9</span><span class="p">,</span>
                     <span class="p">}</span>
    
    <span class="n">sanfranciscoCubeNet</span><span class="o">.</span><span class="n">readNetfile</span> \
      <span class="p">(</span><span class="n">netFile</span><span class="o">=</span><span class="n">SF_CUBE_NET_FILE</span><span class="p">,</span>
       <span class="n">nodeVariableNames</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;N&quot;</span><span class="p">,</span><span class="s">&quot;X&quot;</span><span class="p">,</span><span class="s">&quot;Y&quot;</span><span class="p">,</span><span class="s">&quot;OLD_NODE&quot;</span><span class="p">],</span>
       <span class="n">linkVariableNames</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;A&quot;</span><span class="p">,</span><span class="s">&quot;B&quot;</span><span class="p">,</span><span class="s">&quot;TOLL&quot;</span><span class="p">,</span><span class="s">&quot;USE&quot;</span><span class="p">,</span>
                          <span class="s">&quot;CAP&quot;</span><span class="p">,</span><span class="s">&quot;AT&quot;</span><span class="p">,</span><span class="s">&quot;FT&quot;</span><span class="p">,</span><span class="s">&quot;STREETNAME&quot;</span><span class="p">,</span><span class="s">&quot;TYPE&quot;</span><span class="p">,</span>
                          <span class="s">&quot;MTYPE&quot;</span><span class="p">,</span><span class="s">&quot;SPEED&quot;</span><span class="p">,</span><span class="s">&quot;DISTANCE&quot;</span><span class="p">,</span><span class="s">&quot;TIME&quot;</span><span class="p">,</span>
                          <span class="s">&quot;LANE_AM&quot;</span><span class="p">,</span><span class="s">&quot;LANE_OP&quot;</span><span class="p">,</span><span class="s">&quot;LANE_PM&quot;</span><span class="p">,</span>
                          <span class="s">&quot;BUSLANE_AM&quot;</span><span class="p">,</span><span class="s">&quot;BUSLANE_OP&quot;</span><span class="p">,</span><span class="s">&quot;BUSLANE_PM&quot;</span><span class="p">,</span>
                          <span class="s">&quot;TOLLAM_DA&quot;</span><span class="p">,</span><span class="s">&quot;TOLLAM_SR2&quot;</span><span class="p">,</span><span class="s">&quot;TOLLAM_SR3&quot;</span><span class="p">,</span>
                          <span class="s">&quot;TOLLPM_DA&quot;</span><span class="p">,</span><span class="s">&quot;TOLLPM_SR2&quot;</span><span class="p">,</span><span class="s">&quot;TOLLPM_SR3&quot;</span><span class="p">,</span>
                          <span class="s">&quot;TOLLEA_DA&quot;</span><span class="p">,</span><span class="s">&quot;TOLLEA_SR2&quot;</span><span class="p">,</span><span class="s">&quot;TOLLEA_SR3&quot;</span><span class="p">,</span>
                          <span class="s">&quot;TOLLMD_DA&quot;</span><span class="p">,</span><span class="s">&quot;TOLLMD_SR2&quot;</span><span class="p">,</span><span class="s">&quot;TOLLMD_SR3&quot;</span><span class="p">,</span>
                          <span class="s">&quot;TOLLEV_DA&quot;</span><span class="p">,</span><span class="s">&quot;TOLLEV_SR2&quot;</span><span class="p">,</span><span class="s">&quot;TOLLEV_SR3 &quot;</span><span class="p">,</span>
                          <span class="s">&quot;VALUETOLL_FLAG&quot;</span><span class="p">,</span><span class="s">&quot;PASSTHRU&quot;</span><span class="p">,</span>
                          <span class="s">&quot;BUSTPS_AM&quot;</span><span class="p">,</span><span class="s">&quot;BUSTPS_OP&quot;</span><span class="p">,</span><span class="s">&quot;BUSTPS_PM&quot;</span><span class="p">,</span>
                          <span class="p">],</span>
       <span class="n">centroidIds</span>                      <span class="o">=</span> <span class="n">centroidIds</span><span class="p">,</span>
       <span class="n">useOldNodeForId</span>                  <span class="o">=</span> <span class="bp">True</span><span class="p">,</span>
       <span class="n">nodeGeometryTypeEvalStr</span>          <span class="o">=</span> <span class="s">&quot;Node.GEOMETRY_TYPE_INTERSECTION&quot;</span><span class="p">,</span>
       <span class="n">nodeControlEvalStr</span>               <span class="o">=</span> <span class="s">&quot;RoadNode.CONTROL_TYPE_SIGNALIZED&quot;</span><span class="p">,</span>
       <span class="n">nodePriorityEvalStr</span>              <span class="o">=</span> <span class="s">&quot;RoadNode.PRIORITY_TEMPLATE_NONE&quot;</span><span class="p">,</span>
       <span class="n">nodeLabelEvalStr</span>                 <span class="o">=</span> <span class="s">&quot;None&quot;</span><span class="p">,</span>
       <span class="n">nodeLevelEvalStr</span>                 <span class="o">=</span> <span class="s">&quot;None&quot;</span><span class="p">,</span>
       <span class="n">linkReverseAttachedIdEvalStr</span>     <span class="o">=</span> <span class="s">&quot;None&quot;</span><span class="p">,</span> <span class="c">#TODO: fix?</span>
       <span class="n">linkFacilityTypeEvalStr</span>          <span class="o">=</span> <span class="s">&quot;ftToDTALookup[FT]&quot;</span><span class="p">,</span>
       <span class="n">linkLengthEvalStr</span>                <span class="o">=</span> <span class="s">&quot;float(DISTANCE)&quot;</span><span class="p">,</span>
       <span class="n">linkFreeflowSpeedEvalStr</span>         <span class="o">=</span> <span class="s">&quot;45.0 if FT==&#39;6&#39; else float(speedLookup[&#39;FT&#39;+FT+&#39; AT&#39;+AT])&quot;</span><span class="p">,</span>
       <span class="n">linkEffectiveLengthFactorEvalStr</span> <span class="o">=</span> <span class="s">&quot;1&quot;</span><span class="p">,</span>
       <span class="n">linkResponseTimeFactorEvalStr</span>    <span class="o">=</span> <span class="s">&quot;1.15&quot;</span><span class="p">,</span>  <span class="c"># estimated based on Caltrans sensors for freeways in SF, applied to all network until further analysis</span>
       <span class="n">linkNumLanesEvalStr</span>              <span class="o">=</span> <span class="s">&quot;2 if isConnector else (int(LANE_PM) + (1 if int(BUSLANE_PM)&gt;0 else 0))&quot;</span><span class="p">,</span>
       <span class="n">linkRoundAboutEvalStr</span>            <span class="o">=</span> <span class="s">&quot;False&quot;</span><span class="p">,</span>
       <span class="n">linkLevelEvalStr</span>                 <span class="o">=</span> <span class="s">&quot;None&quot;</span><span class="p">,</span>
       <span class="n">linkLabelEvalStr</span>                 <span class="o">=</span> <span class="s">&#39;(STREETNAME if STREETNAME else &quot;&quot;) + (&quot; &quot; if TYPE and STREETNAME else &quot;&quot;) + (TYPE if TYPE else &quot;&quot;)&#39;</span><span class="p">,</span>
       <span class="n">linkGroupEvalStr</span>                 <span class="o">=</span> <span class="s">&quot;-1&quot;</span><span class="p">,</span>
       <span class="n">linkSkipEvalStr</span>                  <span class="o">=</span> <span class="s">&quot;FT==&#39;13&#39;&quot;</span><span class="p">,</span> <span class="c"># skip bike-only</span>
       <span class="n">additionalLocals</span>                 <span class="o">=</span> <span class="p">{</span><span class="s">&#39;ftToDTALookup&#39;</span><span class="p">:</span><span class="n">ftToDTALookup</span><span class="p">,</span>
                                           <span class="s">&#39;speedLookup&#39;</span><span class="p">:</span><span class="n">speedLookup</span><span class="p">,</span>
                                           <span class="s">&#39;responseTimeLookup&#39;</span><span class="p">:</span><span class="n">responseTimeLookup</span>
                                           <span class="p">})</span>

    <span class="c"># Apply the transit lanes</span>
    <span class="n">createTransitOnlyLanes</span><span class="p">(</span><span class="n">sanfranciscoCubeNet</span><span class="p">,</span> <span class="n">allVCG</span><span class="p">,</span> <span class="n">transitVCG</span><span class="p">)</span>
        
    <span class="c"># create the movements for the network for all vehicles</span>
    <span class="n">sanfranciscoCubeNet</span><span class="o">.</span><span class="n">addAllMovements</span><span class="p">(</span><span class="n">allVCG</span><span class="p">,</span> <span class="n">includeUTurns</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    
    <span class="c"># Apply the turn prohibitions</span>
    <span class="n">sanfranciscoCubeNet</span><span class="o">.</span><span class="n">applyTurnProhibitions</span><span class="p">(</span><span class="n">SF_CUBE_TURN_PROHIBITIONS</span><span class="p">)</span>
    
    <span class="c"># Read the shape points so curvy streets look curvy</span>
    <span class="c"># 3, 4 are the Broadway Tunnel, being routed too far south in GIS file</span>
    <span class="c"># 5234 # Skip this one link at Woodside/Portola because it overlaps</span>
    <span class="c"># 2798, # Skip this Central Freeway link because Dynameq hates it but I DON&#39;T KNOW WHY</span>
    <span class="k">if</span> <span class="n">SF_CUBE_SHAPEFILE</span><span class="p">:</span>
        <span class="n">sanfranciscoCubeNet</span><span class="o">.</span><span class="n">readLinkShape</span><span class="p">(</span><span class="n">SF_CUBE_SHAPEFILE</span><span class="p">,</span> <span class="s">&quot;A&quot;</span><span class="p">,</span> <span class="s">&quot;B&quot;</span><span class="p">,</span>
                                          <span class="n">skipEvalStr</span><span class="o">=</span><span class="s">&quot;(OBJECTID in [3,4,5234,2798]) or (MEDIANDIV==1)&quot;</span><span class="p">)</span>
     
    <span class="c"># Some special links needing shifts</span>
    <span class="n">addShifts</span><span class="p">(</span><span class="n">sanfranciscoCubeNet</span><span class="p">)</span>
    
    <span class="c"># Convert the network to a Dynameq DTA network</span>
    <span class="n">sanfranciscoDynameqNet</span> <span class="o">=</span> <span class="n">dta</span><span class="o">.</span><span class="n">DynameqNetwork</span><span class="p">(</span><span class="n">scenario</span><span class="o">=</span><span class="n">sanfranciscoScenario</span><span class="p">)</span>
    <span class="n">sanfranciscoDynameqNet</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">sanfranciscoCubeNet</span><span class="p">)</span>
    
    <span class="c"># Why would we want to do this?</span>
    <span class="c"># sanfranciscoDynameqNet.removeShapePoints()</span>
    
    <span class="c"># the San Francisco network has a few &quot;HOV stubs&quot; -- links intended to facilitate future coding of HOV lanes</span>
    <span class="n">removeHOVStubs</span><span class="p">(</span><span class="n">sanfranciscoDynameqNet</span><span class="p">)</span>
    
    <span class="c"># Add virtual nodes and links between Centroids and RoadNodes; required by Dynameq</span>
    <span class="n">sanfranciscoDynameqNet</span><span class="o">.</span><span class="n">insertVirtualNodeBetweenCentroidsAndRoadNodes</span><span class="p">(</span><span class="n">startVirtualNodeId</span><span class="o">=</span><span class="mi">9000000</span><span class="p">,</span> <span class="n">startVirtualLinkId</span><span class="o">=</span><span class="mi">9000000</span><span class="p">,</span>
                                                                         <span class="n">distanceFromCentroid</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
    
    <span class="c"># Move the centroid connectors from intersection nodes to midblock locations</span>
    <span class="c"># TODO: for dead-end streets, is this necessary?  Or are the midblocks ok?</span>
        
    <span class="n">sanfranciscoDynameqNet</span><span class="o">.</span><span class="n">moveCentroidConnectorsFromIntersectionsToMidblocks</span><span class="p">(</span><span class="n">splitReverseLinks</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">moveVirtualNodeDist</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">externalNodeIds</span><span class="o">=</span><span class="p">[])</span>
    
    <span class="c"># TODO: I think this isn&#39;t necessary; but discuss if the soln below is ok</span>
    <span class="c"># sanfranciscoDynameqNet.moveVirtualNodesToAvoidShortConnectors(1.05*sanfranciscoScenario.maxVehicleLength(),</span>
    <span class="c">#                                                              maxDistToMove=100) # feet</span>



    <span class="c"># right now this warns; I think some of the handling above might be joined into this (especially if this</span>
    <span class="c"># is the problem the method is meant to solve)</span>
    <span class="n">sanfranciscoDynameqNet</span><span class="o">.</span><span class="n">handleOverlappingLinks</span><span class="p">(</span><span class="n">warn</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">moveVirtualNodeDist</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    
    <span class="c"># finally -- Dynameq requires links to be longer than the longest vehicle</span>
    <span class="n">sanfranciscoDynameqNet</span><span class="o">.</span><span class="n">handleShortLinks</span><span class="p">(</span><span class="mf">1.05</span><span class="o">*</span><span class="n">sanfranciscoScenario</span><span class="o">.</span><span class="n">maxVehicleLength</span><span class="p">()</span><span class="o">/</span><span class="mf">5280.0</span><span class="p">,</span>
                                            <span class="n">warn</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                                            <span class="n">setLength</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="c"># if we have too many nodes for the license 10</span>
    <span class="k">if</span> <span class="n">sanfranciscoDynameqNet</span><span class="o">.</span><span class="n">getNumRoadNodes</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">12500</span><span class="p">:</span>
        <span class="n">sanfranciscoDynameqNet</span><span class="o">.</span><span class="n">removeUnconnectedNodes</span><span class="p">()</span>
    <span class="n">sanfranciscoDynameqNet</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">dir</span><span class="o">=</span><span class="s">r&quot;.&quot;</span><span class="p">,</span> <span class="n">file_prefix</span><span class="o">=</span><span class="s">&quot;sf&quot;</span><span class="p">)</span>
 
    <span class="c"># export the network as shapefiles if requested </span>
    <span class="k">if</span> <span class="n">OUTPUT_NODE_SHAPEFILE</span><span class="p">:</span> <span class="n">sanfranciscoDynameqNet</span><span class="o">.</span><span class="n">writeNodesToShp</span><span class="p">(</span><span class="n">OUTPUT_NODE_SHAPEFILE</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">OUTPUT_LINK_SHAPEFILE</span><span class="p">:</span> <span class="n">sanfranciscoDynameqNet</span><span class="o">.</span><span class="n">writeLinksToShp</span><span class="p">(</span><span class="n">OUTPUT_LINK_SHAPEFILE</span><span class="p">)</span> 
 
    
    
</pre></div>
</td></tr></table></div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Creating the SF DTA Network from Cube Network and Defining the Scenario</a><ul>
<li><a class="reference internal" href="#main">Main</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="_generated/dta.Utils.html"
                        title="previous chapter">dta.Utils</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="script_importTPPlusTransitRoutes.html"
                        title="next chapter">Importing Transit Routes</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/script_createSFNetworkFromCubeNetwork.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="script_importTPPlusTransitRoutes.html" title="Importing Transit Routes"
             >next</a> |</li>
        <li class="right" >
          <a href="_generated/dta.Utils.html" title="dta.Utils"
             >previous</a> |</li>
        <li><a href="index.html">DTA Anyway v1.0 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2011, SFCTA Modeling Crew.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.0.7.
    </div>
  </body>
</html>